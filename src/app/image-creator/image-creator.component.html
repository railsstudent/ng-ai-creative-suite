<div class="container">
  <h1 class="main-header">Image Creator</h1>
  <p class="main-header2">Bring your ideas to life. Describe an image and watch AI create it.</p>

  <div class="generator-container">
    <app-image-menu-bar
      [(prompt)]="prompt"
      [(numberOfImages)]="numberOfImages"
      [(aspectRatio)]="aspectRatio"
      [(enableVideoGeneration)]="enableVideoGeneration"
      [isGeneratingVideo]="isGeneratingVideo()"
      [isGenerateVideoDisabled]="isGenerateVideoDisabled()"
      (generateImage)="generateImage()"
      (generateVideo)="generateVideo()"
    />
  </div>

  <app-prompt-history
    [history]="promptHistory()"
    (promptSelected)="prompt.set($event)"
    (historyCleared)="clearHistory()"
  />

  <app-error-display [error]="error()" />

  <div class="mt-6">
    @if (isLoading()) {
      <app-loader loadingText="Generating your images...">
        <p class="text-sm">This may take a moment.</p>
      </app-loader>
    } @else {
      <app-image-grid
        [images]="imageUrls()"
        [selectedImageId]="selectedImageId()"
        [enableSelection]="enableVideoGeneration()"
        (imageSelected)="selectImage($event)"
        (imageDownloaded)="downloadImage($event)"
        (regenerateImage)="regenerateImage($event)"
      />
    }
  </div>

  @if (enableVideoGeneration()) {
    @if (isGeneratingVideo()) {
      <div class="mt-6">
        <app-loader loadingText="Generating your video...">
          <p class="text-sm">This may take a moment.</p>
        </app-loader>
      </div>
    } @else {
      <app-video-player
        [videoUrl]="videoUrl()"
        [videoError]="videoError()"
        [showHeader]="true"
      />
    }
  }

  <app-confirmation-dialog
    [isOpen]="showDownloadConfirmation() !== 'none'"
    [confirmText]="showDownloadConfirmation() === 'download' ? 'Download' : 'Regenerate'"
    (confirm)="doConfirm()"
    (cancel)="doCancel()"
  >
    @let confirmationType = showDownloadConfirmation();
    @if (confirmationType === 'download') {
      <h3 class="confirm-header">Confirm Download</h3>
      <p class="gray-text">Are you sure you want to download this image?</p>
    } @else if (confirmationType === 'regenerate') {
      <h3 class="confirm-header">Confirm Regenerate Image</h3>
      <p class="gray-text">Are you sure you want to regenerate this image?</p>
    }
  </app-confirmation-dialog>
</div>
